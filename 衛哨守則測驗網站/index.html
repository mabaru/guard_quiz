<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è»äº‹æ¸¬é©—ç³»çµ± v13.3</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #27ae60; --error: #e74c3c; --accent: #f39c12; --blue: #3498db; --purple: #8e44ad; --bg: #f4f7f6; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 0; color: var(--primary); }
        .page { display: none; width: 100%; max-width: 800px; margin: 0 auto; padding: 20px; box-sizing: border-box; }
        .page.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        .hero { text-align: center; padding: 50px 20px; background: linear-gradient(135deg, #2c3e50 0%, #000000 100%); color: white; border-radius: 0 0 30px 30px; margin-bottom: 25px; }
        .card { background: #fff; padding: 25px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .btn { padding: 14px 24px; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; display: block; width: 100%; text-align: center; margin: 10px 0; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-blue { background: var(--blue); color: white; }
        .btn-purple { background: var(--purple); color: white; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-accent { background: var(--accent); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .q-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 12px; border-left: 5px solid var(--blue); padding-left: 10px; }
        .blank-input { border: none; border-bottom: 2px solid #bdc3c7; width: 120px; text-align: center; font-size: 16px; color: var(--error); background: #fffde7; outline: none; }
        .blank-input.wrong { border-bottom: 2px solid var(--error); background: #ffd7d7; }
        .err-hint { font-size: 12px; color: var(--error); display: block; margin-top: -3px; font-weight: bold; }
        .full-input { width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 10px; font-size: 16px; min-height: 150px; box-sizing: border-box; line-height: 1.6; }
        .feedback { margin-top: 15px; padding: 15px; border-radius: 10px; white-space: pre-wrap; display: none; }
        .is-right { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .is-wrong { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .score-display { font-size: 1.4rem; color: var(--accent); font-weight: bold; text-align: center; margin: 15px 0; padding: 10px; border: 2px dashed var(--accent); border-radius: 10px; }
        details { background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #ddd; cursor: pointer; }
        .log-content { font-size: 0.85rem; color: #666; max-height: 150px; overflow-y: auto; padding-top: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        .spec-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px; }
    </style>
</head>
<body>

<div id="page-home" class="page active">
    <div class="hero">
        <h1>æ©Ÿæ­¥ä¸‰ç‡Ÿæ¸¬é©—ç³»çµ± v13.3</h1>
        <p>æ¨™é»ç¬¦è™Ÿå®Œå…¨å®¹éŒ¯ â€¢ è€ƒè©¦åˆ†æ•¸è‡ªå‹•çµç®—</p>
    </div>
    <div class="card">
        <button class="btn btn-primary" onclick="showPage('page-menu')">é–‹å§‹ç·´ç¿’/è€ƒè©¦</button>
        <button class="btn btn-outline" onclick="showPage('page-history')">æŸ¥çœ‹æ­·å²æˆç¸¾</button>
        <details style="margin-top:20px;">
            <summary>ğŸ“œ æ›´æ–°æ—¥èªŒ (v1.0 - v13.3)</summary>
            <div class="log-content">
                <b>v13.3 (æœ€æ–°)</b><br>- å¾¹åº•ä¿®å¾©ï¼šæ¯”å°é‚è¼¯å®Œå…¨å‰”é™¤æ¨™é»ç¬¦è™Ÿï¼Œè§£æ±º 88% éŒ¯èª¤å•é¡Œã€‚<br>- ä¿®æ­£ï¼šè€ƒè©¦çµæŸå¾Œé¡¯ç¤ºç²¾ç¢ºç¸½åˆ†ã€‚<br>- ä¿®æ­£ï¼šç‰¹åˆ¥å®ˆå‰‡å§“å/æ™‚é–“ä¸å†å› å­—æ•¸æˆ–ç¬¦è™Ÿæ‰£åˆ†ã€‚<br><hr>
                <b>v13.2</b><br>- æ–°å¢ï¼šé»˜å¯«å¤±æ•—é¡¯ç¤ºåƒè€ƒç­”æ¡ˆã€‚<br>- ä¿ç•™ï¼šå–®é¡Œé‡è¤‡åˆ·é¡ŒæŒ‰éˆ•ã€‚
            </div>
        </details>
    </div>
</div>

<div id="page-menu" class="page">
    <div class="card">
        <div style="display: flex; gap: 10px;">
            <button id="tab-p" class="btn btn-primary" style="flex:1" onclick="toggleMode('practice')">ç·´ç¿’æ¨¡å¼</button>
            <button id="tab-e" class="btn btn-outline" style="flex:1" onclick="toggleMode('exam')">è€ƒè©¦æ¨¡å¼</button>
        </div>
        <div id="mode-btns" style="margin-top:15px;"></div>
        <button class="btn btn-outline" onclick="showPage('page-home')">è¿”å›é¦–é </button>
    </div>
    <div class="card">
        <h3>ğŸ¯ å–®é¡Œåˆ·é¡Œå€</h3>
        <div class="spec-grid" id="spec-list"></div>
    </div>
</div>

<div id="page-quiz" class="page">
    <div class="card">
        <div id="exam-score-banner" class="score-display" style="display:none"></div>
        <div id="quiz-content"></div>
        <div id="quiz-footer">
            <button id="btn-submit" class="btn btn-secondary">æäº¤æª¢æŸ¥</button>
            <button id="btn-retry" class="btn btn-accent" style="display:none">å†ç·´ä¸€æ¬¡ (é‡è¤‡åˆ·é¡Œ)</button>
            <div id="save-box" style="display:none">
                <input type="text" id="user-name" class="full-input" style="min-height:45px; margin-bottom:10px" placeholder="è«‹è¼¸å…¥å§“åä»¥å­˜æª”">
                <button class="btn btn-secondary" onclick="doSave()">å„²å­˜æˆç¸¾ä¸¦çµæŸ</button>
            </div>
            <button class="btn btn-outline" onclick="showPage('page-menu')">è¿”å›é¸å–®</button>
        </div>
    </div>
</div>

<div id="page-history" class="page">
    <div class="card">
        <h2>ğŸ“Š æ­·å²æˆç¸¾å–®</h2>
        <table>
            <thead><tr><th>å§“å</th><th>è¡›å“¨åˆ†</th><th>æ™‚æ©Ÿåˆ†</th><th>æ—¥æœŸ</th></tr></thead>
            <tbody id="history-body"></tbody>
        </table>
        <button class="btn btn-primary" style="margin-top:20px" onclick="showPage('page-home')">å›é¦–é </button>
    </div>
</div>

<script>
    const G_DATA = [
        {id:1, type:"g", q:"1.è¡›å“¨å…µä¹‹ä»»å‹™ç‚ºä½•?", keys:["ç¶­è­·è»ç´€", "ä¿éšœå®‰å…¨", "ç›£è­·è­¦æˆ’", "ç‰¹å®šä»»å‹™"], raw:"è¡›å…µ:ä»¥ç¶­è­·è»ç´€åŠä¿éšœå®‰å…¨ç‚ºä¸»ã€‚ å“¨å…µ:å·²åŸ·è¡Œç›£è­·è­¦æˆ’åŠç‰¹å®šä»»å‹™ç‚ºä¸»ã€‚", w:10},
        {id:2, type:"g", q:"2.è¡›å…µçš„è·è²¬ç‚ºä½•?", keys:["å…§è¡›å…µ", "ç‡Ÿèˆå®‰å…¨", "è»ç´€ç§©åº", "å¤–è¡›å…µ", "ç³¾å¯Ÿ", "äººè»Šå‡ºå…¥ç®¡åˆ¶"], raw:"å…§è¡›å…µ:ä¿è­·ç‡Ÿèˆå®‰å…¨ï¼Œç¶­è­·è»ç´€ç§©åºã€‚ å¤–è¡›å…µ:ç³¾å¯Ÿå‡ºå…¥å®˜å…µæœå‹™å„€å®¹ï¼ŒæŸ¥é©—å‡ºå…¥ç‰©å“ï¼ŒåŸ·è¡Œäººè»Šå‡ºå…¥ç®¡åˆ¶ï¼Œç¶­è­·è²¬ä»»å€å…§å®‰å…¨ï¼Œæ”¯æ´é„°è¿‘è¡›å…µã€‚", w:10},
        {id:3, type:"g", q:"3.å®‰å…¨å£«å®˜åŸ·æŒç‚ºä½•?", keys:["2å°æ™‚", "ç«™å§¿", "4å°æ™‚", "åå§¿", "ç›¤æŸ¥", "æˆ°æƒ…å®¤", "å–®ç¨é™ªåŒç£å°", "é©åˆ‡è™•ç½®", "é€ç´šå›å ±"], raw:"1.å€¼å‹¤æ™‚ï¼Œ2å°æ™‚ä¹‹è¡›å“¨æ¡ç«™å§¿å€¼å‹¤ï¼›4å°æ™‚ä¹‹è¡›å“¨æ¡åå§¿å€¼å‹¤ã€‚2.å€¼å‹¤æ™‚ç†Ÿè¨˜å„é …å®ˆå‰‡åŠç®¡åˆ¶å–®ä½äººå“¡é€²å‡ºï¼Œé‡åˆ°å¯ç–‘äººç‰©éœ€ä¸Šå‰ç›¤æŸ¥ã€‚3.é‡åˆ°ä¸Šç´šé•·å®˜ç£å°ï¼Œé ˆç«‹å³é€šçŸ¥æˆ°æƒ…å®¤ï¼Œä¸¦ç”±é€£ç´šå¹¹éƒ¨é™ªåŒï¼Œä¸å¯å–®ç¨é™ªåŒç£å°ã€‚4.è‹¥é‡ç‹€æ³ï¼Œæ‡‰ä¾ç›¸é—œä½œæ¥­è¦å®šï¼Œé©åˆ‡è™•ç½®ï¼Œé€ç´šå›å ±æˆ°æƒ…å®¤ã€‚", w:10},
        {id:4, type:"g", q:"4.ç‰¹åˆ¥å®ˆå‰‡", keys:["æ©Ÿæ­¥ä¸€é€£", "109å¤§æ¨“", "107ç‡Ÿèˆ", "äºŒç´šå ´", "æ©Ÿæ­¥ä¸‰é€£", "äº”ç™¾éšœç¤™å ´"], raw:"æˆ‘æ˜¯æ©Ÿæ­¥ä¸‰ç‡Ÿæ©Ÿæ­¥ä¸€é€£æ´¾é£{æ™‚é–“}å®‰å…¨å£«å®˜{éšç´š}{å§“å}ï¼Œæˆ‘çš„ä½ç½®æ–¼109å¤§æ¨“ä¸€æ¨“ä¸­å»Šæ­£å‰æ–¹25å…¬å°ºç‚º107ç‡Ÿèˆï¼Œå³æ–¹30å…¬å°ºè™•ç‚ºä¸€ç‡ŸäºŒç´šå ´ï¼Œå¾Œæ–¹25å…¬å°ºè™•ç‚ºæ©Ÿæ­¥ä¸‰é€£ç‡Ÿèˆï¼Œå·¦æ–¹40å…¬å°ºè™•ç‚ºäº”ç™¾éšœç¤™å ´ï¼Œå ±å‘Šå®Œç•¢ã€‚", w:15},
        {id:5, type:"g", q:"5.ä¸€èˆ¬å®ˆå‰‡", keys:["æœè£æ•´é½Š", "é…ä»¶å…‰äº®", "ç²¾ç¥é£½æ»¿", "å§¿æ…‹ç«¯æ­£", "æ¢°å½ˆæ”œå¸¶", "åˆ‡éµè¦å®š", "å …å®ˆå´—ä½", "åš´å¯†æœç´¢", "æé«˜è­¦è¦º", "æ™‚æ™‚æˆ’å‚™", "ä¸çœ‹ç†±é¬§", "æ³¨æ„å¯ç–‘", "æœå‹¤èªçœŸ", "èªªè©±å®¢æ°£", "åš´æ ¼ç®¡åˆ¶", "ä»”ç´°æŸ¥é©—"], raw:"1.æœè£æ•´é½Šã€é…ä»¶å…‰äº®ã€‚2.ç²¾ç¥é£½æ»¿ã€å§¿æ…‹ç«¯æ­£ã€‚3.æ¢°å½ˆæ”œå¸¶ã€åˆ‡éµè¦å®šã€‚4.å …å®ˆå´—ä½ã€åš´å¯†æœç´¢ã€‚5.æé«˜è­¦è¦ºã€æ™‚æ™‚æˆ’å‚™ã€‚6.ä¸çœ‹ç†±é¬§ã€æ³¨æ„å¯ç–‘ã€‚7.æœå‹¤èªçœŸã€èªªè©±å®¢æ°£ã€‚8.åš´æ ¼ç®¡åˆ¶ã€ä»”ç´°æŸ¥é©—ã€‚", w:15},
        {id:6, type:"g", q:"6.å®‰å…¨å£«å®˜å®ˆå‰‡", keys:["è² è²¬å–®ä½å®‰å…¨", "æ¢°å½ˆæ¸…é»ç®¡åˆ¶", "åš´å¯†æ°´é›»ç®¡ç†", "æ¸…é»å°±å¯¢äººæ•¸", "å·¡è¦–è¡›å“¨å‹¤å‹™", "æ³¨æ„å¯ç–‘äººç‰©", "æ¥è½æˆ°æƒ…é›»è©±", "åæ‡‰ç·Šæ€¥äº‹æ•…"], raw:"1.è² è²¬å–®ä½å®‰å…¨ã€‚2.æ¢°å½ˆæ¸…é»ç®¡åˆ¶ã€‚3.åš´å¯†æ°´é›»ç®¡ç†ã€‚4.æ¸…é»å°±å¯¢äººæ•¸ã€‚5.å·¡è¦–è¡›å“¨å‹¤å‹™ã€‚6.æ³¨æ„å¯ç–‘äººç‰©ã€‚7.æ¥è½æˆ°æƒ…é›»è©±ã€‚8.åæ‡‰ç·Šæ€¥äº‹æ•…ã€‚", w:15},
        {id:7, type:"g", q:"7.æƒ…å ±å‚³é", keys:["ä½•äºº", "ä½•æ™‚", "ä½•åœ°", "ä½•äº‹", "ç‚ºä½•"], raw:"ä½•äººã€ä½•æ™‚ã€ä½•åœ°ã€ä½•äº‹ã€ç‚ºä½•ã€‚", w:15},
        {id:8, type:"g", q:"8.è¡›å“¨å…µä¹‹å®šç¾©ç‚ºä½•?", keys:["ç‡Ÿå€å…§", "è­¦æˆ’ä»»å‹™", "ç‡Ÿå€å¤–", "è­¦æˆ’äººå“¡"], raw:"è¡›å…µ:å‡¡åœ¨ç‡Ÿå€å…§ä¹‹åœ°å€ï¼Œæ“”ä»»è­¦æˆ’ä»»å‹™äººå“¡ã€‚å“¨å…µ:åœ¨ç‡Ÿå€å¤–ï¼Œæ“”ä»»è­¦æˆ’äººå“¡ã€‚", w:10}
    ];

    const L_DATA = [
        {id:9, type:"l", q:"9.å™¨æ¢°ä½¿ç”¨æ™‚æ©Ÿ", keys:["éå¸¸è®Šæ•…", "è»äº‹å®‰å…¨", "é¨·å‹•è¡Œç‚º", "é™æ§ç„¡äººæ©Ÿ", "è¨­æ–½", "æ©Ÿå¯†è³‡è¨Š", "é­å—å±å®³", "æ‹’æ•", "å¼·æš´", "æ»‹äº‹"], raw:"(ä¸€)ç‚ºé¿å…éå¸¸è®Šæ•…ï¼Œç¶­æŒè»äº‹å®‰å…¨ã€‚(äºŒ)é¨·å‹•è¡Œç‚ºè¶³ä»¥å±å®³è»äº‹å®‰å…¨ã€‚(ä¸‰)é™æ§ç„¡äººæ©Ÿæˆ–å…¶ä»–ç„¡äººæ©Ÿé£›è¡Œç‰©å­é£›è¶Šè»äº‹ç‡Ÿå€ï¼Œè€Œæœ‰å±å®³åœ‹é˜²ã€è»äº‹ä¹‹è¨­æ–½æˆ–æ©Ÿå¯†è³‡è¨Šä¹‹è™ã€‚(å››)è­¦æˆ’ã€ç®¡åˆ¶ä¹‹å ´æ‰€ã€å»ºç¯‰ç‰©ã€ç‰©å“ã€è»Šã€èˆ¹ã€èˆªç©ºå™¨æˆ–è²¡ç”¢é­å—å±å®³ã€‚(äº”)ä¾æ³•æ‡‰é€®æ•ä¹‹äººæ‹’æ•ã€è„«é€ƒ(å…­)ç”Ÿå‘½ã€èº«é«”ã€è‡ªç”±é­å—å¼·æš´ã€è„…è¿«ï¼Œæˆ–æœ‰äº‹å¯¦è¶³èªç‚ºæœ‰å±å®³ä¹‹è™ã€‚(ä¸ƒ)æŒæœ‰åˆ€æ¢°è€Œæœ‰æ»‹äº‹è€…ï¼Œç¶“å‘Šèª¡æ‹‹æ£„ï¼Œä»ä¸è½å¾ã€‚", w:70},
        {id:10, type:"l", q:"10.æ­¦å™¨ä½¿ç”¨æ™‚æ©Ÿ", keys:["ä¸è¶³ä»¥æ’é™¤ä¾µå®³", "ç·Šæ€¥å±æ©Ÿ", "ç¾åœ¨ä¸æ³•ä¹‹ä¾µå®³", "é˜²è¡›è‡ªå·±"], raw:"(ä¸€)å‰é …å„æ¬¾ä¹‹æƒ…å½¢ï¼Œä½¿ç”¨å™¨æ¢°ä¸è¶³ä»¥æ’é™¤ä¾µå®³æˆ–é˜»æ­¢æ‡‰é€®æ•ä¹‹äººæ‹’æ•ã€è„«é€ƒã€‚(äºŒ)ç‚ºé¿å…è‡ªå·±æˆ–ä»–äººç”Ÿå‘½ã€èº«é«”ã€è‡ªç”±ã€è²¡ç”¢ä¹‹ç·Šæ€¥å±æ©Ÿæ™‚ã€‚(ä¸‰)å°æ–¼ç¾åœ¨ä¸æ³•ä¹‹ä¾µå®³ï¼Œè€Œå‡ºæ–¼é˜²è¡›è‡ªå·±æˆ–ä»–äººæ¬Šåˆ©æ™‚ã€‚", w:30}
    ];

    let state = { mode: 'practice', type: 'fill', gs: 0, ls: 0, range: 'g', isExam: false, lastId: -1 };

    function showPage(p) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById(p).classList.add('active');
        if(p === 'page-history') renderHistory();
    }

    function toggleMode(m) {
        state.mode = m;
        const box = document.getElementById('mode-btns');
        document.getElementById('tab-p').className = m==='practice'?'btn btn-primary':'btn btn-outline';
        document.getElementById('tab-e').className = m==='exam'?'btn btn-primary':'btn btn-outline';
        box.innerHTML = `<button class="btn btn-blue" onclick="initQuiz('fill','g',${m==='exam'})">è¡›å“¨å¡«ç©º</button>
                         <button class="btn btn-purple" onclick="initQuiz('dict','g',${m==='exam'})">è¡›å“¨é»˜å¯«</button><hr>
                         <button class="btn btn-secondary" onclick="initQuiz('fill','l',${m==='exam'})">æ™‚æ©Ÿå¡«ç©º</button>
                         <button class="btn btn-secondary" onclick="initQuiz('dict','l',${m==='exam'})">æ™‚æ©Ÿé»˜å¯«</button>`;
    }

    function initQuiz(type, range, isExam, sid = -1) {
        showPage('page-quiz');
        state = { type, range, isExam, lastId: sid, gs: 0, ls: 0 };
        const cont = document.getElementById('quiz-content');
        cont.innerHTML = "";
        document.getElementById('btn-submit').style.display = 'block';
        document.getElementById('btn-retry').style.display = 'none';
        document.getElementById('save-box').style.display = 'none';
        document.getElementById('exam-score-banner').style.display = 'none';
        
        let pool = range === 'g' ? G_DATA : L_DATA;
        let targets = sid === -1 ? pool : pool.filter(d => d.id === sid);

        targets.forEach(item => {
            let html = `<div class="q-block" style="margin-bottom:30px;"><div class="q-title">${item.q}</div>`;
            if(type === 'fill') {
                let txt = item.raw;
                if(item.id === 4) {
                    txt = txt.replace(/{æ™‚é–“}/g, `<input type="text" class="blank-input" data-ans="ANY" placeholder="æ™‚é–“" data-id="4">`)
                             .replace(/{éšç´š}/g, `<input type="text" class="blank-input" data-ans="ANY" placeholder="éšç´š" data-id="4">`)
                             .replace(/{å§“å}/g, `<input type="text" class="blank-input" data-ans="ANY" placeholder="å§“å" data-id="4">`);
                }
                item.keys.forEach(k => {
                    txt = txt.replace(k, `<span><input type="text" class="blank-input" data-ans="${k}" data-id="${item.id}"><span class="err-hint"></span></span>`);
                });
                html += `<div style="line-height:2.6; white-space:pre-wrap;">${txt}</div>`;
            } else {
                html += `<textarea class="full-input" data-id="${item.id}" placeholder="è«‹åœ¨æ­¤è¼¸å…¥é»˜å¯«å…§å®¹ï¼Œç³»çµ±æœƒè‡ªå‹•ç„¡è¦–æ¨™é»ç¬¦è™Ÿ..."></textarea>`;
            }
            html += `<div id="fb-${item.id}" class="feedback"></div></div>`;
            cont.innerHTML += html;
        });
        document.getElementById('btn-submit').onclick = () => check(targets);
    }

    function ultraClean(s) {
        // æ ¸å¿ƒä¿®æ­£ï¼šç§»é™¤æ‰€æœ‰ç©ºæ ¼ã€æ¨™é»ã€æ›è¡Œã€å¼•è™Ÿç­‰éåœ‹å­—/æ•¸å­—å…ƒ
        return s.toString().replace(/\s+/g, '').replace(/[ï¼Œã€‚ï¼›ï¼š()ï¼ˆï¼‰ï¼šã€.ï¼ï¼ï¼Ÿ,!?\-\/"â€œâ€1234567890(ä¸€)(äºŒ)(ä¸‰)(å››)(äº”)(å…­)(ä¸ƒ)]/g, '');
    }

    function check(targets) {
        let sc = 0;
        targets.forEach(item => {
            const fb = document.getElementById(`fb-${item.id}`);
            const ins = document.querySelectorAll(`[data-id="${item.id}"]`);
            let hit = 0;
            if(state.type === 'fill') {
                ins.forEach(i => {
                    let u = i.value.trim();
                    let a = i.dataset.ans;
                    let ok = (a === "ANY") ? (u.length > 0) : (ultraClean(u) === ultraClean(a));
                    if(ok) {
                        hit++; i.classList.remove('wrong'); if(i.nextSibling) i.nextSibling.innerHTML = "";
                    } else {
                        i.classList.add('wrong'); if(i.nextSibling) i.nextSibling.innerHTML = `(âŒï¼š${u||'ç©º'}â†’${a})`;
                    }
                });
            } else {
                let userTxt = ultraClean(ins[0].value);
                item.keys.forEach(k => { 
                    if(userTxt.includes(ultraClean(k))) hit++; 
                });
                // ç‰¹åˆ¥å®ˆå‰‡é¡å¤–è£œæ­£
                if(item.id === 4 && userTxt.length > 30) hit += 1;
            }
            let pc = Math.min(100, Math.round((hit / (state.type==='fill'?ins.length:item.keys.length)) * 100));
            let refText = (pc < 100) ? `<br><br><span style="color:#666">âŒ åƒè€ƒç­”æ¡ˆï¼š<br>${item.raw.replace(/{æ™‚é–“}|{éšç´š}|{å§“å}/g, 'â—‹â—‹')}</span>` : "";
            fb.innerHTML = `é”æˆåº¦ï¼š${pc}% ${pc===100?'âœ…':'âŒ'}${refText}`;
            fb.className = `feedback ${pc===100?'is-right':'is-wrong'}`;
            fb.style.display = 'block';
            if(pc===100) sc += item.w;
        });

        if(state.isExam) {
            state.gs = state.range === 'g' ? sc : 0;
            state.ls = state.range === 'l' ? sc : 0;
            const banner = document.getElementById('exam-score-banner');
            banner.innerHTML = `ğŸ–ï¸ è€ƒè©¦çµç®—åˆ†æ•¸ï¼š${sc} åˆ†`;
            banner.style.display = 'block';
            document.getElementById('btn-submit').style.display = 'none';
            document.getElementById('save-box').style.display = 'block';
        } else {
            document.getElementById('btn-submit').style.display = 'none';
            document.getElementById('btn-retry').style.display = 'block';
            document.getElementById('btn-retry').onclick = () => initQuiz(state.type, state.range, false, state.lastId);
        }
    }

    function doSave() {
        const name = document.getElementById('user-name').value || "ç„¡åæˆ°å£«";
        const records = JSON.parse(localStorage.getItem('MIL_DB_133') || "[]");
        records.unshift({ n: name, g: state.gs, l: state.ls, t: new Date().toLocaleString() });
        localStorage.setItem('MIL_DB_133', JSON.stringify(records.slice(0, 15)));
        showPage('page-home');
    }

    function renderHistory() {
        const r = JSON.parse(localStorage.getItem('MIL_DB_133') || "[]");
        document.getElementById('history-body').innerHTML = r.map(i => `<tr><td>${i.n}</td><td>${i.g}</td><td>${i.l}</td><td>${i.t}</td></tr>`).join('');
    }

    window.onload = () => {
        toggleMode('practice');
        const list = document.getElementById('spec-list');
        [...G_DATA, ...L_DATA].forEach(item => {
            list.innerHTML += `<div class="spec-card"><b>${item.q}</b><div style="display:flex; gap:8px; margin-top:10px;">
                <button class="btn btn-blue" style="padding:5px; font-size:12px; margin:0;" onclick="initQuiz('fill','${item.type}',false,${item.id})">å¡«ç©º</button>
                <button class="btn btn-purple" style="padding:5px; font-size:12px; margin:0;" onclick="initQuiz('dict','${item.type}',false,${item.id})">é»˜å¯«</button>
            </div></div>`;
        });
    };
</script>
</body>
</html>
    </style>
</head>
<body>

<div id="page-home" class="page active">
    <div class="hero">
        <h1>æ©Ÿæ­¥ä¸‰ç‡Ÿæ¸¬é©—ç³»çµ± v13.2</h1>
        <p>åˆ†æ•¸çµç®—ä¿®æ­£ â€¢ æ¨™é»æ™ºæ…§æ¯”å°</p>
    </div>
    <div class="card">
        <button class="btn btn-primary" onclick="showPage('page-menu')">é–‹å§‹ç·´ç¿’/è€ƒè©¦</button>
        <button class="btn btn-outline" onclick="showPage('page-history')">æ­·å²æˆç¸¾ç´€éŒ„</button>
        <details style="margin-top:20px;">
            <summary>ğŸ“œ ç‰ˆæœ¬æ›´æ–°æ—¥èªŒ (v1.0 - v13.2)</summary>
            <div class="log-content">
                <b>v13.2 (æœ€æ–°)</b><br>- ä¿®æ­£ï¼šè€ƒè©¦æ¨¡å¼åˆ†æ•¸ç„¡æ³•æ­£ç¢ºé¡¯ç¤ºçš„é‚è¼¯éŒ¯èª¤ã€‚<br>- ä¿®æ­£ï¼šå…¨é¡Œç›®æ–‡å­—ç²¾ç¢ºæ ¡æ­£ï¼ˆæ´¾é£ã€æœå‹¤èªçœŸï¼‰ã€‚<br>- æ–°å¢ï¼šé»˜å¯«å¤±æ•—è‡ªå‹•é¡¯ç¤ºåƒè€ƒç­”æ¡ˆã€‚<br>- ä¿ç•™ï¼šå–®é¡Œã€Œå†ç·´ä¸€æ¬¡ã€æŒ‰éˆ•ã€‚<br><hr>
                <b>v13.0</b><br>- ä¿®æ­£ï¼šæ™ºæ…§å¿½ç•¥æ¨™é»ç¬¦è™Ÿæ¯”å°é‚è¼¯ã€‚
            </div>
        </details>
    </div>
</div>

<div id="page-menu" class="page">
    <div class="card">
        <div style="display: flex; gap: 10px;">
            <button id="tab-p" class="btn btn-primary" style="flex:1" onclick="toggleMode('practice')">ç·´ç¿’æ¨¡å¼</button>
            <button id="tab-e" class="btn btn-outline" style="flex:1" onclick="toggleMode('exam')">è€ƒè©¦æ¨¡å¼</button>
        </div>
        <div id="mode-btns" style="margin-top:15px;"></div>
        <button class="btn btn-outline" onclick="showPage('page-home')">è¿”å›é¦–é </button>
    </div>
    <div class="card">
        <h3>ğŸ¯ å–®é¡Œç²¾ç†Ÿè¨“ç·´</h3>
        <div class="spec-grid" id="spec-list"></div>
    </div>
</div>

<div id="page-quiz" class="page">
    <div class="card">
        <div id="exam-result-box" class="score-box" style="display:none"></div>
        <div id="quiz-content"></div>
        <div id="quiz-footer">
            <button id="btn-submit" class="btn btn-secondary">æª¢æŸ¥ç­”æ¡ˆ</button>
            <button id="btn-retry" class="btn btn-accent" style="display:none">å†ç·´ä¸€æ¬¡ (é‡è¤‡åˆ·é¡Œ)</button>
            <div id="save-box" style="display:none">
                <input type="text" id="user-name" class="full-input" style="min-height:45px; margin-bottom:10px" placeholder="è¼¸å…¥å§“åå„²å­˜æˆç¸¾">
                <button class="btn btn-secondary" onclick="doSave()">ç¢ºèªå„²å­˜ä¸¦é›¢é–‹</button>
            </div>
            <button class="btn btn-outline" onclick="showPage('page-menu')">å–æ¶ˆ/é›¢é–‹</button>
        </div>
    </div>
</div>

<div id="page-history" class="page">
    <div class="card">
        <h2>ğŸ“Š æˆç¸¾å–®</h2>
        <table>
            <thead><tr><th>å§“å</th><th>è¡›å“¨</th><th>æ™‚æ©Ÿ</th><th>æ—¥æœŸ</th></tr></thead>
            <tbody id="history-body"></tbody>
        </table>
        <button class="btn btn-primary" style="margin-top:20px" onclick="showPage('page-home')">å›é¦–é </button>
    </div>
</div>

<script>
    const G_DATA = [
        {id:1, type:"g", q:"1.è¡›å“¨å…µä¹‹ä»»å‹™ç‚ºä½•?", keys:["ç¶­è­·è»ç´€", "ä¿éšœå®‰å…¨", "ç›£è­·è­¦æˆ’", "ç‰¹å®šä»»å‹™"], raw:"è¡›å…µ:ä»¥ç¶­è­·è»ç´€åŠä¿éšœå®‰å…¨ç‚ºä¸»ã€‚ å“¨å…µ:å·²åŸ·è¡Œç›£è­·è­¦æˆ’åŠç‰¹å®šä»»å‹™ç‚ºä¸»ã€‚", w:10},
        {id:2, type:"g", q:"2.è¡›å…µçš„è·è²¬ç‚ºä½•?", keys:["å…§è¡›å…µ", "ç‡Ÿèˆå®‰å…¨", "è»ç´€ç§©åº", "å¤–è¡›å…µ", "ç³¾å¯Ÿ", "äººè»Šå‡ºå…¥ç®¡åˆ¶"], raw:"å…§è¡›å…µ:ä¿è­·ç‡Ÿèˆå®‰å…¨ï¼Œç¶­è­·è»ç´€ç§©åºã€‚ å¤–è¡›å…µ:ç³¾å¯Ÿå‡ºå…¥å®˜å…µæœå‹™å„€å®¹ï¼ŒæŸ¥é©—å‡ºå…¥ç‰©å“ï¼ŒåŸ·è¡Œäººè»Šå‡ºå…¥ç®¡åˆ¶ï¼Œç¶­è­·è²¬ä»»å€å…§å®‰å…¨ï¼Œæ”¯æ´é„°è¿‘è¡›å…µã€‚", w:10},
        {id:3, type:"g", q:"3.å®‰å…¨å£«å®˜åŸ·æŒç‚ºä½•?", keys:["2å°æ™‚", "ç«™å§¿", "4å°æ™‚", "åå§¿", "ç›¤æŸ¥", "æˆ°æƒ…å®¤", "å–®ç¨é™ªåŒç£å°", "é©åˆ‡è™•ç½®", "é€ç´šå›å ±"], raw:"1.å€¼å‹¤æ™‚ï¼Œ2å°æ™‚ä¹‹è¡›å“¨æ¡ç«™å§¿å€¼å‹¤ï¼›4å°æ™‚ä¹‹è¡›å“¨æ¡åå§¿å€¼å‹¤ã€‚2.å€¼å‹¤æ™‚ç†Ÿè¨˜å„é …å®ˆå‰‡åŠç®¡åˆ¶å–®ä½äººå“¡é€²å‡ºï¼Œé‡åˆ°å¯ç–‘äººç‰©éœ€ä¸Šå‰ç›¤æŸ¥ã€‚3.é‡åˆ°ä¸Šç´šé•·å®˜ç£å°ï¼Œé ˆç«‹å³é€šçŸ¥æˆ°æƒ…å®¤ï¼Œä¸¦ç”±é€£ç´šå¹¹éƒ¨é™ªåŒï¼Œä¸å¯å–®ç¨é™ªåŒç£å°ã€‚4.è‹¥é‡ç‹€æ³ï¼Œæ‡‰ä¾ç›¸é—œä½œæ¥­è¦å®šï¼Œé©åˆ‡è™•ç½®ï¼Œé€ç´šå›å ±æˆ°æƒ…å®¤ã€‚", w:10},
        {id:4, type:"g", q:"4.ç‰¹åˆ¥å®ˆå‰‡", keys:["æ©Ÿæ­¥ä¸€é€£", "109å¤§æ¨“", "107ç‡Ÿèˆ", "äºŒç´šå ´", "æ©Ÿæ­¥ä¸‰é€£", "äº”ç™¾éšœç¤™å ´"], raw:"æˆ‘æ˜¯æ©Ÿæ­¥ä¸‰ç‡Ÿæ©Ÿæ­¥ä¸€é€£æ´¾é£{æ™‚é–“}å®‰å…¨å£«å®˜{éšç´š}{å§“å}ï¼Œæˆ‘çš„ä½ç½®æ–¼109å¤§æ¨“ä¸€æ¨“ä¸­å»Šæ­£å‰æ–¹25å…¬å°ºç‚º107ç‡Ÿèˆï¼Œå³æ–¹30å…¬å°ºè™•ç‚ºä¸€ç‡ŸäºŒç´šå ´ï¼Œå¾Œæ–¹25å…¬å°ºè™•ç‚ºæ©Ÿæ­¥ä¸‰é€£ç‡Ÿèˆï¼Œå·¦æ–¹40å…¬å°ºè™•ç‚ºäº”ç™¾éšœç¤™å ´ï¼Œå ±å‘Šå®Œç•¢ã€‚", w:15},
        {id:5, type:"g", q:"5.ä¸€èˆ¬å®ˆå‰‡", keys:["æœè£æ•´é½Š", "é…ä»¶å…‰äº®", "ç²¾ç¥é£½æ»¿", "å§¿æ…‹ç«¯æ­£", "æ¢°å½ˆæ”œå¸¶", "åˆ‡éµè¦å®š", "å …å®ˆå´—ä½", "åš´å¯†æœç´¢", "æé«˜è­¦è¦º", "æ™‚æ™‚æˆ’å‚™", "ä¸çœ‹ç†±é¬§", "æ³¨æ„å¯ç–‘", "æœå‹¤èªçœŸ", "èªªè©±å®¢æ°£", "åš´æ ¼ç®¡åˆ¶", "ä»”ç´°æŸ¥é©—"], raw:"1.æœè£æ•´é½Šã€é…ä»¶å…‰äº®ã€‚2.ç²¾ç¥é£½æ»¿ã€å§¿æ…‹ç«¯æ­£ã€‚3.æ¢°å½ˆæ”œå¸¶ã€åˆ‡éµè¦å®šã€‚4.å …å®ˆå´—ä½ã€åš´å¯†æœç´¢ã€‚5.æé«˜è­¦è¦ºã€æ™‚æ™‚æˆ’å‚™ã€‚6.ä¸çœ‹ç†±é¬§ã€æ³¨æ„å¯ç–‘ã€‚7.æœå‹¤èªçœŸã€èªªè©±å®¢æ°£ã€‚8.åš´æ ¼ç®¡åˆ¶ã€ä»”ç´°æŸ¥é©—ã€‚", w:15},
        {id:6, type:"g", q:"6.å®‰å…¨å£«å®˜å®ˆå‰‡", keys:["å–®ä½å®‰å…¨", "æ¢°å½ˆæ¸…é»", "æ°´é›»ç®¡ç†", "æ¸…é»äººæ•¸", "å·¡è¦–è¡›å“¨", "å¯ç–‘äººç‰©", "æ¥è½æˆ°æƒ…", "ç·Šæ€¥äº‹æ•…"], raw:"1.è² è²¬å–®ä½å®‰å…¨ã€‚2.æ¢°å½ˆæ¸…é»ç®¡åˆ¶ã€‚3.åš´å¯†æ°´é›»ç®¡ç†ã€‚4.æ¸…é»å°±å¯¢äººæ•¸ã€‚5.å·¡è¦–è¡›å“¨å‹¤å‹™ã€‚6.æ³¨æ„å¯ç–‘äººç‰©ã€‚7.æ¥è½æˆ°æƒ…é›»è©±ã€‚8.åæ‡‰ç·Šæ€¥äº‹æ•…ã€‚", w:15},
        {id:7, type:"g", q:"7.æƒ…å ±å‚³é", keys:["ä½•äºº", "ä½•æ™‚", "ä½•åœ°", "ä½•äº‹", "ç‚ºä½•"], raw:"ä½•äººã€ä½•æ™‚ã€ä½•åœ°ã€ä½•äº‹ã€ç‚ºä½•ã€‚", w:15},
        {id:8, type:"g", q:"8.è¡›å“¨å…µä¹‹å®šç¾©ç‚ºä½•?", keys:["ç‡Ÿå€å…§", "è­¦æˆ’ä»»å‹™", "ç‡Ÿå€å¤–", "è­¦æˆ’äººå“¡"], raw:"è¡›å…µ:å‡¡åœ¨ç‡Ÿå€å…§ä¹‹åœ°å€ï¼Œæ“”ä»»è­¦æˆ’ä»»å‹™äººå“¡ã€‚å“¨å…µ:åœ¨ç‡Ÿå€å¤–ï¼Œæ“”ä»»è­¦æˆ’äººå“¡ã€‚", w:10}
    ];

    const L_DATA = [
        {id:9, type:"l", q:"9.å™¨æ¢°ä½¿ç”¨æ™‚æ©Ÿ", keys:["éå¸¸è®Šæ•…", "è»äº‹å®‰å…¨", "é¨·å‹•è¡Œç‚º", "é™æ§ç„¡äººæ©Ÿ", "è¨­æ–½", "æ©Ÿå¯†è³‡è¨Š", "é­å—å±å®³", "æ‹’æ•", "å¼·æš´", "æ»‹äº‹"], raw:"(ä¸€)ç‚ºé¿å…éå¸¸è®Šæ•…ï¼Œç¶­æŒè»äº‹å®‰å…¨ã€‚(äºŒ)é¨·å‹•è¡Œç‚ºè¶³ä»¥å±å®³è»äº‹å®‰å…¨ã€‚(ä¸‰)é™æ§ç„¡äººæ©Ÿæˆ–å…¶ä»–ç„¡äººæ©Ÿé£›è¡Œç‰©å­é£›è¶Šè»äº‹ç‡Ÿå€ï¼Œè€Œæœ‰å±å®³åœ‹é˜²ã€è»äº‹ä¹‹è¨­æ–½æˆ–æ©Ÿå¯†è³‡è¨Šä¹‹è™ã€‚(å››)è­¦æˆ’ã€ç®¡åˆ¶ä¹‹å ´æ‰€ã€å»ºç¯‰ç‰©ã€ç‰©å“ã€è»Šã€èˆ¹ã€èˆªç©ºå™¨æˆ–è²¡ç”¢é­å—å±å®³ã€‚(äº”)ä¾æ³•æ‡‰é€®æ•ä¹‹äººæ‹’æ•ã€è„«é€ƒ(å…­)ç”Ÿå‘½ã€èº«é«”ã€è‡ªç”±é­å—å¼·æš´ã€è„…è¿«ï¼Œæˆ–æœ‰äº‹å¯¦è¶³èªç‚ºæœ‰å±å®³ä¹‹è™ã€‚(ä¸ƒ)æŒæœ‰åˆ€æ¢°è€Œæœ‰æ»‹äº‹è€…ï¼Œç¶“å‘Šèª¡æ‹‹æ£„ï¼Œä»ä¸è½å¾ã€‚", w:70},
        {id:10, type:"l", q:"10.æ­¦å™¨ä½¿ç”¨æ™‚æ©Ÿ", keys:["ä¸è¶³ä»¥æ’é™¤ä¾µå®³", "ç·Šæ€¥å±æ©Ÿ", "ç¾åœ¨ä¸æ³•ä¹‹ä¾µå®³", "é˜²è¡›è‡ªå·±"], raw:"(ä¸€)å‰é …å„æ¬¾ä¹‹æƒ…å½¢ï¼Œä½¿ç”¨å™¨æ¢°ä¸è¶³ä»¥æ’é™¤ä¾µå®³æˆ–é˜»æ­¢æ‡‰é€®æ•ä¹‹äººæ‹’æ•ã€è„«é€ƒã€‚(äºŒ)ç‚ºé¿å…è‡ªå·±æˆ–ä»–äººç”Ÿå‘½ã€èº«é«”ã€è‡ªç”±ã€è²¡ç”¢ä¹‹ç·Šæ€¥å±æ©Ÿæ™‚ã€‚(ä¸‰)å°æ–¼ç¾åœ¨ä¸æ³•ä¹‹ä¾µå®³ï¼Œè€Œå‡ºæ–¼é˜²è¡›è‡ªå·±æˆ–ä»–äººæ¬Šåˆ©æ™‚ã€‚", w:30}
    ];

    let state = { type: 'fill', gs: 0, ls: 0, range: 'g', isExam: false, lastId: -1 };

    function showPage(p) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById(p).classList.add('active');
        if(p === 'page-history') renderHistory();
    }

    function toggleMode(m) {
        const box = document.getElementById('mode-btns');
        document.getElementById('tab-p').className = m==='practice'?'btn btn-primary':'btn btn-outline';
        document.getElementById('tab-e').className = m==='exam'?'btn btn-primary':'btn btn-outline';
        box.innerHTML = `<button class="btn btn-blue" onclick="initQuiz('fill','g',${m==='exam'})">è¡›å“¨å¡«ç©º</button>
                         <button class="btn btn-purple" onclick="initQuiz('dict','g',${m==='exam'})">è¡›å“¨é»˜å¯«</button><hr>
                         <button class="btn btn-secondary" onclick="initQuiz('fill','l',${m==='exam'})">æ™‚æ©Ÿå¡«ç©º</button>
                         <button class="btn btn-secondary" onclick="initQuiz('dict','l',${m==='exam'})">æ™‚æ©Ÿé»˜å¯«</button>`;
    }

    function initQuiz(type, range, isExam, sid = -1) {
        showPage('page-quiz');
        state = { type, range, isExam, lastId: sid, gs: 0, ls: 0 };
        const cont = document.getElementById('quiz-content');
        cont.innerHTML = "";
        document.getElementById('btn-submit').style.display = 'block';
        document.getElementById('btn-retry').style.display = 'none';
        document.getElementById('save-box').style.display = 'none';
        document.getElementById('exam-result-box').style.display = 'none';
        
        let pool = range === 'g' ? G_DATA : L_DATA;
        let targets = sid === -1 ? pool : pool.filter(d => d.id === sid);

        targets.forEach(item => {
            let html = `<div class="q-block" style="margin-bottom:30px;"><div class="q-title">${item.q}</div>`;
            if(type === 'fill') {
                let txt = item.raw;
                if(item.id === 4) {
                    txt = txt.replace(/{æ™‚é–“}/g, `<input type="text" class="blank-input" data-ans="ANY" placeholder="æ™‚é–“" data-id="4">`)
                             .replace(/{éšç´š}/g, `<input type="text" class="blank-input" data-ans="ANY" placeholder="éšç´š" data-id="4">`)
                             .replace(/{å§“å}/g, `<input type="text" class="blank-input" data-ans="ANY" placeholder="å§“å" data-id="4">`);
                }
                item.keys.forEach(k => {
                    txt = txt.replace(k, `<span><input type="text" class="blank-input" data-ans="${k}" data-id="${item.id}"><span class="err-hint"></span></span>`);
                });
                html += `<div style="line-height:2.6; white-space:pre-wrap;">${txt}</div>`;
            } else {
                html += `<textarea class="full-input" data-id="${item.id}" placeholder="è«‹é»˜å¯«å®Œæ•´å…§å®¹..."></textarea>`;
            }
            html += `<div id="fb-${item.id}" class="feedback"></div></div>`;
            cont.innerHTML += html;
        });
        document.getElementById('btn-submit').onclick = () => check(targets);
    }

    function ultraClean(s) {
        return s.toString().replace(/\s+/g, '').replace(/[ï¼Œã€‚ï¼›ï¼š()ï¼ˆï¼‰ï¼šã€.ï¼ï¼ï¼Ÿ,!?\-\/]/g, '');
    }

    function check(targets) {
        let sc = 0;
        targets.forEach(item => {
            const fb = document.getElementById(`fb-${item.id}`);
            const ins = document.querySelectorAll(`[data-id="${item.id}"]`);
            let hit = 0;
            if(state.type === 'fill') {
                ins.forEach(i => {
                    let u = i.value.trim();
                    let a = i.dataset.ans;
                    let ok = (a === "ANY") ? (u.length > 0) : (ultraClean(u) === ultraClean(a));
                    if(ok) {
                        hit++; i.classList.remove('wrong'); if(i.nextSibling) i.nextSibling.innerHTML = "";
                    } else {
                        i.classList.add('wrong'); if(i.nextSibling) i.nextSibling.innerHTML = `(âŒï¼š${u||'ç©º'}â†’${a})`;
                    }
                });
            } else {
                let userTxt = ultraClean(ins[0].value);
                item.keys.forEach(k => { if(userTxt.includes(ultraClean(k))) hit++; });
            }
            let pc = Math.min(100, Math.round((hit / (state.type==='fill'?ins.length:item.keys.length)) * 100));
            let refText = (state.type === 'dict' && pc < 100) ? `<br><br><span style="color:#666">âŒ åƒè€ƒç­”æ¡ˆï¼š<br>${item.raw.replace(/{æ™‚é–“}|{éšç´š}|{å§“å}/g, 'â—‹â—‹')}</span>` : "";
            fb.innerHTML = `é”æˆåº¦ï¼š${pc}% ${pc===100?'âœ…':'âŒ'}${refText}`;
            fb.className = `feedback ${pc===100?'is-right':'is-wrong'}`;
            fb.style.display = 'block';
            if(pc===100) sc += item.w;
        });

        if(state.isExam) {
            if(state.range === 'g') state.gs = sc; else state.ls = sc;
            const resBox = document.getElementById('exam-result-box');
            resBox.innerHTML = `ğŸ“ æ¸¬é©—çµç®—ï¼š<br>è¡›å“¨å®ˆå‰‡ï¼š${state.range==='g'?sc:0} åˆ† / æ™‚æ©Ÿæ³•è¦ï¼š${state.range==='l'?sc:0} åˆ†`;
            resBox.style.display = 'block';
            document.getElementById('btn-submit').style.display = 'none';
            document.getElementById('save-box').style.display = 'block';
        } else {
            document.getElementById('btn-submit').style.display = 'none';
            document.getElementById('btn-retry').style.display = 'block';
            document.getElementById('btn-retry').onclick = () => initQuiz(state.type, state.range, false, state.lastId);
        }
    }

    function doSave() {
        const name = document.getElementById('user-name').value || "ç„¡åè‹±é›„";
        const records = JSON.parse(localStorage.getItem('MIL_DB_132') || "[]");
        records.unshift({ n: name, g: state.range==='g'?state.gs:0, l: state.range==='l'?state.ls:0, t: new Date().toLocaleDateString() });
        localStorage.setItem('MIL_DB_132', JSON.stringify(records.slice(0, 15)));
        showPage('page-home');
    }

    function renderHistory() {
        const r = JSON.parse(localStorage.getItem('MIL_DB_132') || "[]");
        document.getElementById('history-body').innerHTML = r.map(i => `<tr><td>${i.n}</td><td>${i.g}</td><td>${i.l}</td><td>${i.t}</td></tr>`).join('');
    }

    window.onload = () => {
        toggleMode('practice');
        const list = document.getElementById('spec-list');
        [...G_DATA, ...L_DATA].forEach(item => {
            list.innerHTML += `<div class="spec-card"><b>${item.q}</b><div style="display:flex; gap:8px; margin-top:10px;">
                <button class="btn btn-blue" style="padding:5px; font-size:12px; margin:0;" onclick="initQuiz('fill','${item.type}',false,${item.id})">å¡«ç©º</button>
                <button class="btn btn-purple" style="padding:5px; font-size:12px; margin:0;" onclick="initQuiz('dict','${item.type}',false,${item.id})">é»˜å¯«</button>
            </div></div>`;
        });
    };
</script>
</body>
</html>
